"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6600],{3658:n=>{n.exports=JSON.parse('{"permalink":"/blog/2025/11/24/","editUrl":"https://github.com/logicbaron/logicbaron.github.io/tree/dev/blog/2025-11-24.md","source":"@site/blog/2025-11-24.md","title":"RAG & Milvus \uac04\ub2e8 \uc815\ub9ac","description":"RAG","date":"2025-11-24T00:00:00.000Z","tags":[],"readingTime":2.72,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"nextItem":{"title":"\uccab \uc11c\ube44\uc2a4 \ubc30\ud3ec\uae30","permalink":"/blog/2025/11/12/"}}')},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>c});var t=i(6540);const r={},s=t.createContext(r);function l(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),t.createElement(s.Provider,{value:e},n.children)}},9855:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>o});var t=i(3658),r=i(4848),s=i(8453);const l={},c="RAG & Milvus \uac04\ub2e8 \uc815\ub9ac",a={authorsImageUrls:[]},o=[];function d(n){const e={code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:"RAG"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ub370\uc774\ud130 indexing \uccb4\uacc4\uac00 \ub354 \uc911\uc694\ud558\ub2e4\uace0 \uc0dd\uac01\ub428."}),"\n",(0,r.jsx)(e.li,{children:"pre-retrieval, retrieval-time, post-retrieval \uac80\uc0ac\uac00 \uc804\ubd80 \uc774\ub8e8\uc5b4\uc9d0."}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Faiss Index"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ANN \uae30\ubc18"}),"\n",(0,r.jsx)(e.li,{children:"IndexHNSWFlat : \ube4c\ub4dc O(NlogN) \ubc31\ub9cc\uac1c\uc5d0 \uc218\ucd08. \uc11c\uce58 O(logN) \ubc31\ub9cc\uac1c \ubb38\uc11c \uae30\uc900 \ubc00\ub9ac\ucd08."}),"\n",(0,r.jsx)(e.li,{children:"Hierarchical Navigable Small World"}),"\n",(0,r.jsx)(e.li,{children:"\uacc4\uce35\uc801 \uadf8\ub798\ud504\ub97c \uadf8\ub9ac\uace0 \ucd5c\ub2e8 \uac70\ub9ac \uae30\ubc18\uc73c\ub85c \ud0d0\uc0c9. \uacc4\uce35\uc744 \ud0c0\uace0 \ubaa9\ud45c \uc9c0\uc810 \uadfc\ucc98\ub85c \ube60\ub974\uac8c \uac04 \ud6c4, \uc815\ubc00 \ud0d0\uc0c9\ud558\ub294 \ubc29\uc2dd."}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Milvus"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"faiss \ub97c \ud575\uc2ec\uc73c\ub85c \ud558\ub294 \ubca1\ud130DB - DB\uc758 \ud14c\uc774\ube14 \uc5ed\ud560."}),"\n",(0,r.jsx)(e.li,{children:'Milvus\uc5d0\uc11c \ubca1\ud130\ub97c \uc800\uc7a5\ud558\ub294 \ub17c\ub9ac\uc801 \ub2e8\uc704 : "\uceec\ub809\uc158"'}),"\n",(0,r.jsx)(e.li,{children:"ANN \uad6c\uc870\ub97c \ud65c\uc6a9\ud574\uc11c \ubca1\ud130\ub97c \uc800\uc7a5"}),"\n",(0,r.jsx)(e.li,{children:"Faiss/ milvus \ubaa8\ub450 \ubcd1\ub82c \ucc98\ub9ac \ud658\uacbd\uc5d0 \ucd5c\uc801\ud654 \ub418\uc5b4 \uc788\uc74c."}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Milvus \uad6c\ucd95\uc608\uc2dc : \ud14c\uc774\ube14 \uc5ed\ud560\uc744 \ud558\ub294 \uceec\ub809\uc158 \uc0dd\uc131."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'from pymilvus import connections, utility, Collection, FieldSchema, CollectionSchema, DataType\nimport numpy as np\n\n# 1. Milvus \uc11c\ubc84 \uc5f0\uacb0 \uc124\uc815\n# \ub85c\uceec\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 Milvus \uc11c\ubc84\uc5d0 \uc5f0\uacb0\ud569\ub2c8\ub2e4. (\uae30\ubcf8 \ud3ec\ud2b8: 19530)\n# Milvus \uc11c\ubc84\uac00 \ub2e4\ub978 \uacf3\uc5d0 \uc788\ub2e4\uba74 \uc8fc\uc18c\ub97c \ubcc0\uacbd\ud574\uc57c \ud569\ub2c8\ub2e4.\ntry:\n    connections.connect(alias="default", host="localhost", port="19530")\n    print("\u2705 Milvus \uc11c\ubc84 \uc5f0\uacb0 \uc131\uacf5.")\nexcept Exception as e:\n    print(f"\u274c Milvus \uc11c\ubc84 \uc5f0\uacb0 \uc2e4\ud328: {e}. \uc11c\ubc84\uac00 \uc2e4\ud589 \uc911\uc778\uc9c0 \ud655\uc778\ud558\uc138\uc694.")\n    exit()\n\nCOLLECTION_NAME = "rag_document_chunks"\nDIMENSION = 128  # \ubca1\ud130 \ucc28\uc6d0 (\uc608: \uc784\ubca0\ub529 \ubaa8\ub378\uc758 \ucd9c\ub825 \ucc28\uc6d0)\n\n# \uceec\ub809\uc158\uc774 \uc774\ubbf8 \uc874\uc7ac\ud558\uba74 \uc0ad\uc81c\ud569\ub2c8\ub2e4.\nif utility.has_collection(COLLECTION_NAME):\n    utility.drop_collection(COLLECTION_NAME)\n    print(f"\uae30\uc874 \uceec\ub809\uc158 \'{COLLECTION_NAME}\' \uc0ad\uc81c \uc644\ub8cc.")\n\n# 2. \uceec\ub809\uc158 \uc2a4\ud0a4\ub9c8 \uc815\uc758 (\ub370\uc774\ud130 \uad6c\uc870 \uc815\uc758)\n# Milvus\ub294 \ubca1\ud130 \uc678\uc5d0 \uba54\ud0c0\ub370\uc774\ud130\ub3c4 \uc800\uc7a5\ud574\uc57c \ud569\ub2c8\ub2e4.\n\nfields = [\n    # \ud544\ub4dc 1: primary key (\uace0\uc720 ID)\n    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True, description="Primary ID"),\n    \n    # \ud544\ub4dc 2: RAG\uc758 \uc6d0\ubcf8 \ud14d\uc2a4\ud2b8 \uccad\ud06c\ub97c \uc2dd\ubcc4\ud558\ub294 ID (\uba54\ud0c0\ub370\uc774\ud130)\n    FieldSchema(name="chunk_id", dtype=DataType.VARCHAR, max_length=256, description="Original Chunk ID"),\n    \n    # \ud544\ub4dc 3: \ubca1\ud130 \ud544\ub4dc (\uac00\uc7a5 \uc911\uc694)\n    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=DIMENSION, description="Vector embedding")\n]\n\nschema = CollectionSchema(fields, description="RAG Document Chunks Collection")\n\n# 3. \uceec\ub809\uc158 \uc0dd\uc131\ncollection = Collection(name=COLLECTION_NAME, schema=schema)\nprint(f"\ud83d\udce6 \uceec\ub809\uc158 \'{COLLECTION_NAME}\' \uc0dd\uc131 \uc644\ub8cc.")\n'})}),"\n",(0,r.jsx)(e.p,{children:"Milvus \ub370\uc774\ud130 \uc0bd\uc785: \ubca1\ud130 insert -> index \uad6c\ucd95 \uc21c\uc11c\ub85c \uc9c4\ud589\ub428."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# --- 4. \ub370\uc774\ud130 \uc900\ube44 (RAG \uc784\ubca0\ub529 \uc2dc\ubbac\ub808\uc774\uc158) ---\nnum_entities = 1000  # \uc0bd\uc785\ud560 \ubca1\ud130\uc758 \uc218\nrng = np.random.default_rng(1234)\n\n# 128\ucc28\uc6d0\uc758 \ub79c\ub364 \ubca1\ud130 1000\uac1c \uc0dd\uc131\ndata = [rng.random((DIMENSION,)).astype(\'float32\') for _ in range(num_entities)]\n# \uba54\ud0c0\ub370\uc774\ud130 (RAG\uc5d0\uc11c \uc2e4\uc81c \ud14d\uc2a4\ud2b8 \uccad\ud06c\uc640 \uc5f0\uacb0\ub420 ID)\nchunk_ids = [f"chunk_{i}" for i in range(num_entities)]\n\n# \ub370\uc774\ud130 \uad6c\uc870\ud654 (Milvus \uc0bd\uc785 \ud615\uc2dd)\nentities = [\n    chunk_ids,\n    data\n]\n\n# --- 5. \ub370\uc774\ud130 \uc0bd\uc785 ---\ninsert_result = collection.insert(entities)\nprint(f"\ud83d\udce5 {len(insert_result.primary_keys)}\uac1c\uc758 \uc5d4\ud2f0\ud2f0 \uc0bd\uc785 \uc644\ub8cc.")\n\n# --- 6. \uc778\ub371\uc2a4 \uad6c\ucd95 (\ud575\uc2ec RAG \ub2e8\uacc4) ---\n# Milvus\uc5d0\uac8c Faiss\uc758 HNSW \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc778\ub371\uc2a4\ub97c \ub9cc\ub4e4\ub3c4\ub85d \uc9c0\uc2dc\ud569\ub2c8\ub2e4.\n# \uc774 \uc778\ub371\uc2a4\ub294 \uc2e4\uc81c\ub85c Milvus \ub0b4\uc5d0\uc11c Faiss \uc5d4\uc9c4\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.\nindex_params = {\n    "index_type": "HNSW",\n    "metric_type": "L2",  # \uc720\ud074\ub9ac\ub4dc \uac70\ub9ac (L2) \uc0ac\uc6a9\n    "params": {"M": 16, "efConstruction": 200} # HNSW \ud558\uc774\ud37c\ud30c\ub77c\ubbf8\ud130\n}\n\ncollection.create_index("embedding", index_params)\nprint("\u2699\ufe0f \uc778\ub371\uc2a4 HNSW \uad6c\ucd95 \uc644\ub8cc.")\n\n# \ub370\uc774\ud130\ub97c \uac80\uc0c9\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uba54\ubaa8\ub9ac\uc5d0 \ub85c\ub4dc\ud569\ub2c8\ub2e4.\ncollection.load() \nprint("\uba54\ubaa8\ub9ac \ub85c\ub4dc \uc644\ub8cc.")\n'})}),"\n",(0,r.jsx)(e.p,{children:"\ubca1\ud130 \uac80\uc0c9:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# --- 7. \uc9c8\uc758 \ubca1\ud130 \uc900\ube44 (\uc0ac\uc6a9\uc790 \uc9c8\ubb38 \uc784\ubca0\ub529 \uc2dc\ubbac\ub808\uc774\uc158) ---\n# \ub2e8\uc77c \uc9c8\uc758 \ubca1\ud130 \uc0dd\uc131\nquery_vector = rng.random((1, DIMENSION)).astype(\'float32\')\n\n# --- 8. \uac80\uc0c9 \uc218\ud589 ---\nTOP_K = 5 # \uac00\uc7a5 \uac00\uae4c\uc6b4 5\uac1c \ubca1\ud130\ub97c \uac80\uc0c9\n\nsearch_params = {\n    "metric_type": "L2",\n    "params": {"ef": 50} # HNSW \uac80\uc0c9 \ub9e4\uac1c\ubcc0\uc218 (efSearch\uc640 \uc720\uc0ac)\n}\n\nstart_time = time.time()\nresults = collection.search(\n    data=query_vector,       # \uac80\uc0c9\ud560 \uc9c8\uc758 \ubca1\ud130\n    anns_field="embedding",  # \uac80\uc0c9\uc744 \uc218\ud589\ud560 \ud544\ub4dc (\ubca1\ud130 \ud544\ub4dc)\n    param=search_params,     # \uac80\uc0c9 \ub9e4\uac1c\ubcc0\uc218\n    limit=TOP_K,             # Top-K\n    output_fields=["chunk_id"] # \uacb0\uacfc\ub85c \ubc18\ud658\ubc1b\uc744 \uba54\ud0c0\ub370\uc774\ud130 \ud544\ub4dc\n)\nend_time = time.time()\n\nprint(f"\\n\ud83d\udd0d \uac80\uc0c9 \uc644\ub8cc. (\uc18c\uc694 \uc2dc\uac04: {end_time - start_time:.4f}\ucd08)")\n\n# --- 9. \uacb0\uacfc \ucd9c\ub825 ---\nprint(f"\\n\u2705 \uac80\uc0c9 \uacb0\uacfc (Top-{TOP_K}):")\nfor hit in results[0]:\n    # hit.id\ub294 Milvus\uc758 \ub0b4\ubd80 ID, hit.entity.get(\'chunk_id\')\ub294 \uba54\ud0c0\ub370\uc774\ud130\n    print(f"  - Chunk ID: {hit.entity.get(\'chunk_id\')}, \uc720\uc0ac\ub3c4(\uac70\ub9ac): {hit.distance:.4f}")\n\n# \uc791\uc5c5 \ud6c4 \uc5f0\uacb0 \uc885\ub8cc\nconnections.disconnect("default")\n'})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}}}]);
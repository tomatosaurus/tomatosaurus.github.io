# 웹 서비스를 개발하고 나서 느낀 회고.

0. 일단 API 관련해서

APP_URL, API_URL, NEXT_API_URL 

API_URL 은 서버측 코드에서 사용함. 실제 데이터 베이스나 다른 백엔드 서버와 통신할 떄 사용.
NEXT_API_URL 은 클라이언트 측에서 서버 컴포넌트나 API route가 내부적으로 호출하는 내부 URL, 백엔드 서버 URL.

1. 로그인 관련 시스템

- 로그인 관련 시스템에서 정말 에러 많이 발생함. 로그인 관련해서 이해한 것들을 간단하게 정리해보자.

- 일단 클라이언트가 서버로 로그인 요청을 보냄 : NEXT_API_URL 사용. api.xxxx.com
- 서버는 클라이언트에 쿠키를 생성하고, 쿠키를 response 로 클라이언트에 전송함. 이때 서버에서 받아온 쿠키의 도메인 정보는 api.xxx.com
- 클라이언트는 해당 정보를 저장.
- 이후 클라이언트가 인증 정보가 필요한 페이지에 접속할때 서버에 쿠키 정보를 포함해서 요청을 보냄. api.xxx.com
- 대부분 클라이언트는 도메인 주소를 확인하기 떄문에 api.xxx.com 과 xxx.com 이 다르다고 인지한다. 이 때문에 쿠키 허용 url을 .xxx.com 으로 바꿔준다.

2. 리버스 프록시 서버 구축

nginx 를 통해서 리버스 프록시를 구축.

nginx 서버를 띄우고 내 서버 80번 접속해보면 도메인 이름을 이용해 서버를 열 수 있다.